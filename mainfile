  #install, and recall all the packages and libraries we need
install.packages("cowplot")
install.packages("magick")
install.packages("ggpubr")
library (tidyverse)
library(jsonlite)
library(cowplot)
library(ggplot2)
library(magick)
library(ggpubr)

#We import the JSON dataframe from a GIT repository 
cards <- fromJSON("https://raw.githubusercontent.com/simonelugithub/API-project-/7eb17de80689dcbc6251c354d87aad6bb51ec6b0/MGT.csv")

#we assign the name "df" to our dataframe and select the columns that interest us
df <- as.data.frame(cards)
df <- df[c(1,3,4,7,8,9,11,13,15,16,29)]

#attach function allows us not to repeat the dataframe name in every step
attach(df)

#create two new columns representing the variable average and ratio of each card 
df$cards.average <- as.numeric(df$cards.power) + as.numeric(df$cards.toughness) 
df$cards.ratio <-  as.numeric(df$cards.average) / df$cards.cmc 

#we eliminate null values from columns
df = filter(df, !(cards.power== c("NA","*","*")))

#We create a new dataframe by selecting only the columns that contain the quantitative variables. Thanks to the use of the pipe operator the code is better readable.
df_clean <- df %>% 
  select(cards.name , cards.cmc , cards.rarity , cards.power:cards.ratio)%>%
  arrange(desc(cards.ratio))

#We display only legendary cards thanks to the "filter" function
Legendary.cards= filter(df, cards.supertypes == "Legendary")
Legendary.cards

#we import thanks to an URL the .png logo of Magic to insert it in the graphs
image_to_add <- "https://upload.wikimedia.org/wikipedia/commons/thumb/3/3f/Magicthegathering-logo.svg/1280px-Magicthegathering-logo.svg.png"
theme_set(theme_cowplot())


#We create various graphs using the "ggplot" function to build them.
#The "ggdraw" function allows us to insert an image and place it in the graph where we prefer
ggp1 <- ggplot(data = df_clean) +
  geom_count(mapping = aes(x = cards.average , y = cards.cmc )) 
facet_wrap(~ cards.rarity, nrow = 3) 
ggdraw()+
  draw_image(image_to_add, x = 0.4, y = -0.47, scale = 0.14)+
  draw_plot(ggp1)

ggp2 <- ggplot(data = df_clean) +
  geom_count(mapping = aes(x = cards.power , y = cards.cmc, color = cards.rarity))
ggdraw()+
  draw_image(image_to_add, x = 0.4, y = -0.47, scale = 0.14)+
  draw_plot(ggp2)

ggp3 <- ggplot(data = df_clean) +
  geom_smooth(mapping = aes(x = cards.cmc, y = cards.average))+
  theme_minimal_grid(12)
ggp3

ggp4 <- ggplot(data = df_clean) +
  geom_smooth(
    mapping = aes(x = cards.cmc, y = cards.average, color = cards.rarity),
    show.legend = FALSE
  )
ggdraw()+
  draw_image(image_to_add, x = 0.4, y = -0.47, scale = 0.14)+
  draw_plot(ggp4)
ggp4

ggp5 <- ggplot(data = df_clean) +
  geom_point(mapping = aes(x = cards.cmc, y = cards.average)) +
  geom_smooth(mapping = aes(x = cards.cmc, y = cards.average))
draw_image(image_to_add, x = 0.4, y = -0.47, scale = 0.14)+
  draw_plot(ggp5)


ggp6 <- ggplot(data = df_clean, mapping = aes(x = cards.cmc, y = cards.average)) +
  geom_point(mapping = aes(color = cards.rarity)) +
  geom_smooth()
ggdraw()+
  draw_image(image_to_add, x = 0.4, y = -0.47, scale = 0.14)+
  draw_plot(ggp6)

ggp7 <- ggplot(data = df) + 
  geom_bar(mapping = aes(x = cards.cmc), fill = "#FF6666" )
ggdraw()+
  draw_image(image_to_add, x = 0.4, y = -0.47, scale = 0.14)+
  draw_plot(ggp8)

ggp8 <- ggplot(df, aes(x = "", fill = factor(cards.rarity))) + 
  geom_bar(width = 1) +
  theme(axis.line = element_blank(), 
        plot.title = element_text(hjust=0.5)) + 
  labs(fill="class", 
       x=NULL, 
       y=NULL, 
       title="Bar Chart of cards rarity", 
       caption="Source: DF MTG")
ggdraw()+
  draw_image(image_to_add, x = 0.4, y = -0.47, scale = 0.14)+
  draw_plot(ggp7)

#the function "ggarrange" arrange multiple ggplot objects on a page, aligning the plot panels.
ggarrange(ggp1,ggp2, nrow = 2,ncol = 1)
ggarrange(ggp3, ggp4, nrow = 2,ncol = 1)
ggarrange(ggp5,ggp6,ggp7,ggp8,nrow=2, ncol= 2)
